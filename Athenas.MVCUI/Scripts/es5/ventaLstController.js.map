{"version":3,"sources":["../es6/venta/ventaLstController.js"],"names":["VentaController","service","ui","lstVentas","ventaSeleccionada","AthenasNet","Mant","muestraVentas","filtros","listar","generarTabla","map","p","Id","Cliente","Nombre","Apellido","Colaborador","Trabajador","Fecha","formatFecha","FFecha","Importe","formatPrecio","Total","console","error","manejaEvtTabla","getTblMantenedor","addEventListener","evt","target","dataset","id","accion","find","c","parseInt","setFormMantenedor","Valor","parseFloat","toFixed","Producto","log","mostrarConfirmacion","abreModalVenta","subtotal","descuento","total","Detalles","forEach","det","Cantidad","Precio","DesctUni","ventaMostrada","Codigo","formatCodigo","Dni","Telefono","Descripcion","SubTotal","Descuento","setModalVentaData","manejaEnvioConf","getFormConfirmar","preventDefault","eliminar","ocultarConfirmacion","muestraToast","mensaje","titulo","cssClass","manejaEnvioFiltro","getFormFiltrar","getFiltros","muestraMensaje","localStorage","getItem","JSON","parse","texto","color","removeItem","iniciar"],"mappings":"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","sourcesContent":["﻿const VentaController = (service, ui) => {\r\n    let lstVentas = [];\r\n    let ventaSeleccionada = {};\r\n    const { Mant } = AthenasNet;\r\n\r\n    const muestraVentas = async (filtros = {}) => {\r\n        try {\r\n            lstVentas = await service.listar(filtros);\r\n            ui.generarTabla(lstVentas.map(p => {\r\n\r\n               \r\n                return {\r\n                    Id: p.Id,\r\n                    Cliente: p.Cliente.Nombre + ' ' + p.Cliente.Apellido,\r\n                    Colaborador: p.Trabajador.Nombre + ' ' + p.Trabajador.Apellido,\r\n                    Fecha: AthenasNet.formatFecha(p.FFecha),\r\n                    Importe: AthenasNet.formatPrecio(p.Total)\r\n                }\r\n\r\n            }));\r\n        }\r\n        catch (err) {\r\n            console.error(err);\r\n        }\r\n    }\r\n\r\n\r\n    const manejaEvtTabla = () => {\r\n        Mant.getTblMantenedor().addEventListener('click', async (evt) => {\r\n\r\n            if (evt.target.dataset.id) {\r\n                const { id, accion } = evt.target.dataset;\r\n\r\n                ventaSeleccionada = lstVentas.find(c => c.Id === parseInt(id));\r\n                ventaSeleccionada.accion = accion;\r\n\r\n                if (accion === 'editar') {\r\n                    await muestraVentas();\r\n                    Mant.setFormMantenedor(\r\n                        {\r\n                            ...ventaSeleccionada,\r\n                            Valor: parseFloat(ventaSeleccionada.Valor).toFixed(2),\r\n                            Producto: ventaSeleccionada.Producto.Id,\r\n                            Fecha: ventaSeleccionada.FFecha,                          \r\n                        },\r\n                        ['Activo', 'FFecha']);\r\n                }\r\n                else if (accion === 'eliminar') {\r\n                    console.log('eliminar')\r\n                    AthenasNet.mostrarConfirmacion();\r\n\r\n                } else if (accion === 'detalle') {\r\n                    ui.abreModalVenta();\r\n\r\n                    let subtotal = 0;\r\n                    let descuento = 0;\r\n                    let total = 0;\r\n\r\n                    ventaSeleccionada.Detalles.forEach(det => {\r\n                        subtotal += parseInt(det.Cantidad) * parseFloat(det.Precio),\r\n                        descuento += parseInt(det.Cantidad) * parseFloat(det.DesctUni),\r\n                        total += parseInt(det.Cantidad) * parseFloat(det.Precio) - parseInt(det.Cantidad) * parseFloat(det.DesctUni)\r\n                    })\r\n\r\n                    const ventaMostrada = {\r\n                        Codigo: AthenasNet.formatCodigo(ventaSeleccionada.Id, 'VEN', 4),\r\n                        FFecha: ventaSeleccionada.FFecha,\r\n                        Colaborador: ventaSeleccionada.Trabajador.Nombre + ' ' + ventaSeleccionada.Trabajador.Apellido,\r\n                        Cliente: {\r\n                            Nombre: ventaSeleccionada.Cliente.Nombre,\r\n                            Dni: ventaSeleccionada.Cliente.Dni,\r\n                            Telefono: ventaSeleccionada.Cliente.Telefono\r\n                        },\r\n                        Detalles: ventaSeleccionada.Detalles.map(det => ({\r\n                            Codigo: AthenasNet.formatCodigo(det.Producto.Id, 'PRD', 4),\r\n                            Descripcion: det.Producto.Descripcion,\r\n                            Precio: AthenasNet.formatPrecio(det.Precio),\r\n                            Cantidad: det.Cantidad,\r\n                            SubTotal: AthenasNet.formatPrecio(det.Cantidad * det.Precio),\r\n                            Descuento: AthenasNet.formatPrecio(det.Cantidad * det.DesctUni)\r\n                        })),\r\n                        SubTotal: subtotal.toFixed(2),\r\n                        Descuento: descuento.toFixed(2),\r\n                        Total: total.toFixed(2)\r\n                    }\r\n\r\n                    ui.setModalVentaData(ventaMostrada);\r\n\r\n                }\r\n            }\r\n\r\n\r\n        });\r\n    }\r\n\r\n\r\n\r\n    const manejaEnvioConf = () => {\r\n        AthenasNet.getFormConfirmar().addEventListener('submit', async (evt) => {\r\n            evt.preventDefault();//evitar la accion del evento\r\n            try {\r\n                await service.eliminar(parseInt(ventaSeleccionada.Id));\r\n                AthenasNet.ocultarConfirmacion();\r\n                AthenasNet.muestraToast({ mensaje: 'La venta fue eliminada satisfactoriamente', titulo: 'Eliminación exitosa' })\r\n                await muestraVentas();\r\n            }\r\n            catch (err) {\r\n                console.error(err);\r\n                AthenasNet.muestraToast({ cssClass: 'bg-danger', mensaje: 'Hubo un error en la eliminación', titulo: 'Eliminación errónea' })\r\n            }\r\n\r\n        })\r\n    }\r\n\r\n    const manejaEnvioFiltro = () => {\r\n        Mant.getFormFiltrar().addEventListener('submit', async (evt) => {\r\n            evt.preventDefault();//evitar la accion del evento\r\n            const filtros = ui.getFiltros();\r\n            await muestraVentas(filtros);\r\n        })\r\n    }\r\n\r\n\r\n    const muestraMensaje = () => {\r\n        if (localStorage.getItem('mensaje')) {\r\n\r\n            const mensaje = JSON.parse(localStorage.getItem('mensaje'));\r\n\r\n            AthenasNet.muestraToast({ mensaje: mensaje.texto, titulo: mensaje.titulo, cssClass: mensaje.color })\r\n\r\n            localStorage.removeItem('mensaje');\r\n        }\r\n    }\r\n\r\n    const iniciar = async () => {\r\n\r\n        manejaEvtTabla();\r\n        manejaEnvioConf();\r\n        manejaEnvioFiltro();\r\n        await muestraVentas();\r\n        muestraMensaje();\r\n\r\n    }\r\n\r\n\r\n    return {\r\n        iniciar\r\n    }\r\n}\r\n"],"file":"ventaLstController.js"}
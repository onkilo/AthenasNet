{"version":3,"sources":["../es6/pedido/pedidoRegistroController.js"],"names":["PedidoController","service","ui","proveedorService","productoService","tipoBusqueda","lstDetalles","provSelecionado","prodSelecionado","lstProveedores","lstProductos","evtMostrarModalBuscar","getModalBuscar","on","e","console","log","muestraProveedores","muestraProductos","evtBtnBuscarProducto","getBtnBuscarProducto","addEventListener","evtBtnBuscarProveedor","getBtnBuscarProveedor","listar","data","titulo","cabecera","columnas","map","p","Descripcion","Precio","PrecioCompra","Stock","StockActual","Categoria","Id","setModalBuscarData","evtTblBuscar","listarProveedor","RzSocial","Representante","Direccion","Telefono","getTblModalBuscar","target","dataset","seleccionId","id","find","parseInt","setProveedor","setProducto","Codigo","AthenasNet","formatId","formatPrecio","modal","evtBtnAgregarDet","getBtnAgregarDet","cantidad","document","getElementById","value","encontrado","i","length","Producto","Cantidad","push","setDetallesData","filas","det","SubTotal","mostrarTotal","total","forEach","toFixed","evtEnvioPedido","getFormPedido","preventDefault","pedido","Trabajador","Proveedor","Detalles","crear","muestraToast","cssClass","mensaje","error","iniciar"],"mappings":"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","sourcesContent":["const PedidoController = (service, ui, proveedorService, productoService) => {\r\n\r\n    let tipoBusqueda = null;\r\n    let lstDetalles = [];\r\n    let provSelecionado = {};\r\n    let prodSelecionado = {};\r\n    let lstProveedores = [];\r\n    let lstProductos = [];\r\n\r\n    const evtMostrarModalBuscar = () => {\r\n        ui.getModalBuscar().on('show.bs.modal', (e) => {\r\n            console.log(\"abriendo\")\r\n            if (tipoBusqueda === 'Proveedor') muestraProveedores();\r\n            else muestraProductos();\r\n        })\r\n\r\n    }\r\n\r\n    const evtBtnBuscarProducto = () => {\r\n        ui.getBtnBuscarProducto().addEventListener('click', () => tipoBusqueda = 'Producto' )\r\n    }\r\n    const evtBtnBuscarProveedor = () => {\r\n        console.log(ui.getBtnBuscarProveedor())\r\n        ui.getBtnBuscarProveedor().addEventListener('click', () => {\r\n            tipoBusqueda = 'Proveedor'\r\n        })\r\n    }\r\n\r\n    const muestraProductos = async () => {\r\n\r\n        lstProductos = await productoService.listar({});\r\n        console.log(lstProductos);\r\n\r\n        const data = {\r\n            titulo: 'Buscar Producto',\r\n            cabecera: [\r\n                'Descripción',\r\n                'Precio',\r\n                'Stock',\r\n                'Categoría',\r\n                'Acciones'\r\n            ],\r\n            columnas: lstProductos.map(p => ({\r\n                data: {\r\n                    Descripcion: p.Descripcion,\r\n                    Precio: p.PrecioCompra,\r\n                    Stock: p.StockActual,\r\n                    Categoria: p.Categoria.Descripcion\r\n                },\r\n                Id: p.Id\r\n            }))\r\n        }\r\n\r\n        ui.setModalBuscarData(data);\r\n        evtTblBuscar();\r\n    }\r\n\r\n    const muestraProveedores = async () => {\r\n        lstProveedores = await proveedorService.listarProveedor({});\r\n        console.log(lstProveedores);\r\n\r\n        const data = {\r\n            titulo: 'Buscar Proveedor',\r\n            cabecera: [\r\n                'Razón Social',\r\n                'Representante',\r\n                'Dirección',\r\n                'Teléfono',\r\n                'Acciones'\r\n            ],\r\n            columnas: lstProveedores.map(p => ({\r\n                data: {\r\n                    RzSocial: p.RzSocial,\r\n                    Representante: p.Representante,\r\n                    Direccion: p.Direccion,\r\n                    Telefono: p.Telefono\r\n                },\r\n                Id: p.Id\r\n            }))\r\n        }\r\n\r\n        ui.setModalBuscarData(data);\r\n        evtTblBuscar();\r\n    } \r\n\r\n    const evtTblBuscar = () => {\r\n        ui.getTblModalBuscar().addEventListener('click', (e) => {\r\n\r\n            if (e.target.dataset.seleccionId) {\r\n                const id = e.target.dataset.seleccionId;\r\n                if (tipoBusqueda === 'Proveedor') {\r\n                    provSelecionado = lstProveedores.find((p) => p.Id === parseInt(id))\r\n                    ui.setProveedor(provSelecionado);\r\n                }\r\n                else {\r\n                    prodSelecionado = lstProductos.find((p) => p.Id === parseInt(id))\r\n                    ui.setProducto({\r\n                        ...prodSelecionado,\r\n                        Codigo: AthenasNet.formatId(prodSelecionado.Id, 'PRD', 4),\r\n                        PrecioCompra: AthenasNet.formatPrecio(prodSelecionado.PrecioCompra)\r\n                    });\r\n                }\r\n\r\n                ui.getModalBuscar().modal('hide');\r\n                //$('#modalBuscar').modal('hide');\r\n            }\r\n\r\n        })\r\n    }\r\n\r\n    const evtBtnAgregarDet = () => {\r\n        ui.getBtnAgregarDet().addEventListener('click', () => {\r\n\r\n            const cantidad = document.getElementById('Producto.Cantidad').value;\r\n            let encontrado = false;\r\n\r\n            //lstDetalles.forEach(det => {\r\n            //    if (det.Producto.Id === prodSelecionado.Id) {\r\n            //        det.Cantidad = cantidad;\r\n            //        encontrado = true;\r\n            //        break;\r\n            //    }\r\n            //})\r\n\r\n            for (let i = 0; i < lstDetalles.length; i++) {\r\n                if (lstDetalles[i].Producto.Id === prodSelecionado.Id) {\r\n                    lstDetalles[i].Cantidad = cantidad;\r\n                    encontrado = true;\r\n                    break;\r\n                }\r\n            }\r\n\r\n            if (!encontrado) {\r\n                lstDetalles.push({\r\n                    Producto: {\r\n                        ...prodSelecionado\r\n                    },\r\n                    Cantidad: cantidad,\r\n                    Precio: prodSelecionado.PrecioCompra\r\n                })\r\n            }\r\n            \r\n\r\n            console.log(lstDetalles);\r\n\r\n            ui.setDetallesData({\r\n                filas: lstDetalles.map(det => ({\r\n                    Codigo: AthenasNet.formatId(det.Producto.Id, 'PRD', 4),\r\n                    Descripcion: det.Producto.Descripcion,\r\n                    Cantidad: det.Cantidad,\r\n                    Precio: AthenasNet.formatPrecio(det.Precio),\r\n                    SubTotal: AthenasNet.formatPrecio(det.Cantidad * det.Precio),\r\n                    Id: det.Producto.Id\r\n                }))\r\n            })\r\n\r\n            mostrarTotal();\r\n        });\r\n    }\r\n\r\n    const mostrarTotal = () => {\r\n        let total = 0;\r\n\r\n        lstDetalles.forEach(det => {\r\n            total += (det.Precio * det.Cantidad);\r\n        });\r\n\r\n        document.getElementById('total').value = total.toFixed(2);\r\n    }\r\n\r\n    const evtEnvioPedido = () => {\r\n        ui.getFormPedido().addEventListener('submit', async (e) => {\r\n            e.preventDefault();\r\n\r\n            const pedido = {\r\n                Trabajador: {\r\n                    Id: 8\r\n                },\r\n                Proveedor: {\r\n                    Id: provSelecionado.Id\r\n                },\r\n                Detalles: lstDetalles\r\n            }\r\n\r\n            try {\r\n                await service.crear(pedido);\r\n                AthenasNet.muestraToast({\r\n                    cssClass: 'bg-success', mensaje: 'El pedido se registró correctamente', titulo: 'Éxito'\r\n                })\r\n            }\r\n            catch (err) {\r\n                console.error(err);\r\n                AthenasNet.muestraToast({\r\n                    cssClass: 'bg-danger', mensaje: 'Hubo un error al registrar el pedido', titulo: 'Error'\r\n                })\r\n            }\r\n        })\r\n    }\r\n\r\n    const iniciar = () => {\r\n        evtMostrarModalBuscar();\r\n        evtBtnBuscarProducto();\r\n        evtBtnBuscarProveedor();\r\n        evtBtnAgregarDet();\r\n        evtEnvioPedido();\r\n    }\r\n\r\n\r\n    return {\r\n        iniciar\r\n    }\r\n}"],"file":"pedidoRegistroController.js"}
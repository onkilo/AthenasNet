{"version":3,"sources":["../es6/pedido/pedidoRegistrarController.js"],"names":["PedidoController","service","ui","proveedorService","productoService","lstProductos","lstProveedores","tipoBusqueda","lstDetalles","prodSeleccionado","provSeleccionado","muestraProductos","listar","data","titulo","cabecera","filas","map","prod","Descripcion","Precio","AthenasNet","formatPrecio","PrecioCompra","Stock","StockActual","Categoria","Id","setModalBuscarData","console","log","muestraProveedores","listarProveedor","prov","RzSocial","Representante","Direccion","Telefono","evtBtnBuscarProducto","getBtnBuscarProducto","addEventListener","evtBtnBuscarProveedor","getBtnBuscarProveedor","evtAbreModal","getModalBuscar","on","e","evtBtnSelModalBuscar","getModalContentBuscar","target","dataset","seleccionId","id","parseInt","find","setProducto","Codigo","formatCodigo","validaProdSeleccionado","modal","setProveedor","validaProvSeleccionado","evtBtnAgregarDet","getBtnAgregarDet","cantidad","getInputCantidad","value","validaCantidadDetalle","encontrado","i","length","Producto","Cantidad","push","muestraDetalle","validaDetalle","evtEliminaDetalle","getTblDetalle","productoId","filter","det","total","SubTotal","setDetalleData","setTotal","toFixed","evtFormPedido","formPedido","getFormPedido","preventDefault","pedido","Proveedor","Detalles","crear","mensaje","color","texto","localStorage","setItem","JSON","stringify","window","location","href","MVC_URL_BASE","error","iniciar"],"mappings":"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","sourcesContent":["const PedidoController = (service, ui, proveedorService, productoService) => {\r\n    let lstProductos = [];\r\n    let lstProveedores = [];\r\n    let tipoBusqueda = null;//Producto, Proveedor\r\n    let lstDetalles = [];\r\n    let prodSeleccionado = {};\r\n    let provSeleccionado = {};\r\n\r\n    const muestraProductos = async () => {\r\n        lstProductos = await productoService.listar({});\r\n        const data = {\r\n            titulo: 'Buscar Producto',\r\n            cabecera: [\r\n                'Descripción',\r\n                'Precio',\r\n                'Stock',\r\n                'Categoría',\r\n                'Acciones'\r\n            ],\r\n            filas: lstProductos.map(prod => {\r\n\r\n                return {\r\n                    data: {\r\n                        Descripcion: prod.Descripcion,\r\n                        Precio: AthenasNet.formatPrecio(prod.PrecioCompra),\r\n                        Stock: prod.StockActual,\r\n                        Categoria: prod.Categoria.Descripcion\r\n                    },\r\n                    Id: prod.Id\r\n                }\r\n\r\n            })\r\n        }\r\n\r\n        ui.setModalBuscarData(data);\r\n        console.log(lstProductos)\r\n    }\r\n\r\n    const muestraProveedores = async () => {\r\n        lstProveedores = await proveedorService.listarProveedor({});\r\n        const data = {\r\n            titulo: 'Buscar Proveedor',\r\n            cabecera: [\r\n                'Razón Social',\r\n                'Representante',\r\n                'Dirección',\r\n                'Teléfono',\r\n                'Acciones'\r\n            ],\r\n            filas: lstProveedores.map(prov => {\r\n\r\n                return {\r\n                    data: {\r\n                        RzSocial: prov.RzSocial,\r\n                        Representante: prov.Representante,\r\n                        Direccion: prov.Direccion,\r\n                        Telefono: prov.Telefono\r\n                    },\r\n                    Id: prov.Id\r\n                }\r\n\r\n            })\r\n        }\r\n        ui.setModalBuscarData(data);\r\n        console.log(lstProveedores)\r\n    }\r\n\r\n    const evtBtnBuscarProducto = () => ui.getBtnBuscarProducto().addEventListener('click', () => tipoBusqueda = 'Producto');\r\n\r\n    const evtBtnBuscarProveedor = () => ui.getBtnBuscarProveedor().addEventListener('click', () => tipoBusqueda = 'Proveedor');\r\n\r\n    //const evtAbreModal = () => {\r\n    //    ui.getModalBuscar().on('show.bs.modal', async (e) => {\r\n    //        if (tipoBusqueda === 'Producto') await muestraProductos();\r\n    //        else await muestraProveedores();\r\n\r\n    //        evtBtnSelModalBuscar();\r\n    //    })\r\n    //}\r\n\r\n    const evtAbreModal = () => {\r\n        ui.getModalBuscar().on('show.bs.modal', (e) => {\r\n            if (tipoBusqueda === 'Producto') muestraProductos();\r\n            else muestraProveedores();\r\n        })\r\n    }\r\n\r\n    const evtBtnSelModalBuscar = () => {\r\n\r\n        ui.getModalContentBuscar().addEventListener('click', (e) => {\r\n\r\n            if (e.target.dataset.seleccionId) {\r\n\r\n                console.log('click de seleccion');\r\n\r\n                const id = parseInt(e.target.dataset.seleccionId);\r\n\r\n                if (tipoBusqueda === 'Producto') {\r\n\r\n                    prodSeleccionado = lstProductos.find(prod => prod.Id === id);\r\n\r\n                    ui.setProducto({\r\n                        ...prodSeleccionado,\r\n                        PrecioCompra: AthenasNet.formatPrecio(prodSeleccionado.PrecioCompra),\r\n                        Codigo: AthenasNet.formatCodigo(prodSeleccionado.Id, 'PRD', 4)\r\n                    });\r\n                    ui.validaProdSeleccionado(true);\r\n                    ui.getModalBuscar().modal('hide');\r\n                }\r\n                else {\r\n                    provSeleccionado = lstProveedores.find(prov => prov.Id === id);\r\n\r\n                    ui.setProveedor(provSeleccionado);\r\n                    ui.validaProvSeleccionado(true);\r\n                    ui.getModalBuscar().modal('hide');\r\n                }\r\n\r\n            }\r\n\r\n        })\r\n\r\n    }\r\n\r\n    const evtBtnAgregarDet = () => {\r\n\r\n        ui.getBtnAgregarDet().addEventListener('click', () => {\r\n            \r\n            const cantidad = ui.getInputCantidad().value;\r\n            console.log(cantidad);\r\n            if (!cantidad || parseInt(cantidad) <= 0) {\r\n                ui.validaCantidadDetalle(false);\r\n            }\r\n            else {\r\n                ui.validaCantidadDetalle(true);\r\n            }\r\n            \r\n            \r\n\r\n            if (!prodSeleccionado.Id) {\r\n                ui.validaProdSeleccionado(false);\r\n            }\r\n            \r\n\r\n            if (prodSeleccionado.Id && (cantidad && parseInt(cantidad) > 0)) {\r\n                \r\n                let encontrado = false;\r\n\r\n                for (let i = 0; i < lstDetalles.length; i++) {\r\n\r\n                    if (prodSeleccionado.Id === lstDetalles[i].Producto.Id) {\r\n\r\n                        lstDetalles[i].Cantidad = parseInt(cantidad);\r\n\r\n                        encontrado = true;\r\n                        break;\r\n                    }\r\n\r\n                }\r\n\r\n                if (!encontrado) {\r\n                    lstDetalles.push({\r\n\r\n                        Producto: {\r\n                            Id: prodSeleccionado.Id,\r\n                            Descripcion: prodSeleccionado.Descripcion\r\n                        },\r\n                        Cantidad: parseInt(cantidad),\r\n                        Precio: prodSeleccionado.PrecioCompra\r\n\r\n                    });\r\n                }\r\n\r\n\r\n                muestraDetalle();\r\n                ui.validaDetalle(true);\r\n                ui.setProducto({\r\n                    Codigo: '',\r\n                    Descripcion: '',\r\n                    PrecioCompra: '',\r\n                    StockActual: ''\r\n                })\r\n\r\n                prodSeleccionado = {};\r\n                ui.getInputCantidad().value = '';\r\n            }\r\n            \r\n        })\r\n\r\n    }\r\n\r\n    const evtEliminaDetalle = () => {\r\n\r\n        ui.getTblDetalle().addEventListener('click', (e) => {\r\n\r\n            if (e.target.dataset.productoId) {\r\n                const id = parseInt(e.target.dataset.productoId);\r\n\r\n                lstDetalles = lstDetalles.filter(det => det.Producto.Id !== id);\r\n                muestraDetalle();\r\n\r\n\r\n            }\r\n\r\n        })\r\n\r\n    }\r\n\r\n    const muestraDetalle = () => {\r\n        let total = 0;\r\n\r\n        const data = {\r\n\r\n            filas: lstDetalles.map(det => {\r\n\r\n                total += parseInt(det.Cantidad) * det.Precio;\r\n\r\n                return {\r\n                    data: {\r\n                        Codigo: AthenasNet.formatCodigo(det.Producto.Id, 'PRD', 4),\r\n                        Descripcion: det.Producto.Descripcion,\r\n                        Precio: AthenasNet.formatPrecio(det.Precio),\r\n                        Cantidad: det.Cantidad,\r\n                        SubTotal: AthenasNet.formatPrecio(det.Precio * det.Cantidad)\r\n                        \r\n                    },\r\n                    productoId: det.Producto.Id\r\n                }\r\n\r\n            })\r\n        }\r\n\r\n        ui.setDetalleData(data);\r\n        ui.setTotal(total.toFixed(2));\r\n    }\r\n\r\n    const evtFormPedido = () => {\r\n        const formPedido = ui.getFormPedido();\r\n        formPedido.addEventListener('submit', async (e) => {\r\n\r\n            e.preventDefault();\r\n            debugger\r\n            const pedido = {\r\n                Proveedor: {\r\n                    Id: provSeleccionado.Id\r\n                },\r\n                Detalles: lstDetalles\r\n            }\r\n            if (!pedido.Proveedor.Id) {\r\n                ui.validaProvSeleccionado(false);\r\n            }\r\n\r\n            if (lstDetalles.length <= 0) {\r\n                ui.validaDetalle(false);\r\n            }\r\n            if (pedido.Proveedor.Id && lstDetalles.length > 0) {\r\n                try {\r\n\r\n                    await service.crear(pedido)\r\n                    const mensaje = {\r\n                        color: 'bg-success',\r\n                        titulo: 'Registro exitoso',\r\n                        texto: 'El pedido fue registrado exitosamente'\r\n                    }\r\n                    localStorage.setItem('mensaje', JSON.stringify(mensaje));\r\n                    window.location.href = AthenasNet.MVC_URL_BASE + 'Pedido';\r\n                }\r\n                catch (err) {\r\n                    console.error(err);\r\n                }\r\n            }\r\n                   \r\n        })\r\n\r\n    }\r\n\r\n    const iniciar = () => {\r\n        evtBtnBuscarProducto();\r\n        evtBtnBuscarProveedor();\r\n        evtAbreModal();\r\n        evtBtnSelModalBuscar();\r\n        evtBtnAgregarDet();\r\n        evtEliminaDetalle();\r\n        evtFormPedido();\r\n    }\r\n\r\n    return {\r\n        iniciar\r\n    }\r\n}"],"file":"pedidoRegistrarController.js"}